{# Cisco ASA Configuration Template #}
{# Generated by Nautobot Golden Config #}

! ============================================
! Device: {{ obj.name }}
! Location: {{ obj.location.name if obj.location else "Unknown" }}
! Platform: {{ obj.platform.name if obj.platform else "Unknown" }}
! Generated: {{ now() }}
! ============================================

! ===== BASIC CONFIGURATION =====
hostname {{ obj.name }}

! ===== DOMAIN CONFIGURATION =====
{% if obj.config_context.domain %}
domain-name {{ obj.config_context.domain }}
{% else %}
domain-name example.com
{% endif %}

! ===== DNS CONFIGURATION =====
{% if obj.config_context.dns_servers %}
{% for dns in obj.config_context.dns_servers %}
dns domain-lookup {{ obj.config_context.get('dns_interface', 'management') }}
dns server-group DefaultDNS
 name-server {{ dns }}
{% endfor %}
{% endif %}

! ===== NTP CONFIGURATION =====
{% if obj.config_context.ntp_servers %}
{% for ntp in obj.config_context.ntp_servers %}
ntp server {{ ntp }}
{% endfor %}
{% else %}
! No NTP servers configured
{% endif %}

! ===== MANAGEMENT INTERFACE =====
{% if obj.primary_ip4 %}
interface Management0/0
 nameif management
 security-level 100
 ip address {{ obj.primary_ip4.address.ip }} {{ obj.primary_ip4.address.netmask }}
 no shutdown
{% endif %}

! ===== ADDITIONAL INTERFACES =====
{% for interface in obj.interfaces.all() %}
{% if interface.enabled and interface.name != "Management0/0" %}
interface {{ interface.name }}
 nameif {{ interface.cf.nameif | default(interface.name|lower|replace('/', '_')) }}
 {% if interface.description %}
 description {{ interface.description }}
 {% endif %}
 {% if interface.mode == 'access' %}
 security-level {{ interface.cf.security_level | default('0') }}
 {% endif %}
 {% for ip_address in interface.ip_addresses.all() %}
 ip address {{ ip_address.address.ip }} {{ ip_address.address.netmask }}
 {% endfor %}
 no shutdown
{% endif %}
{% endfor %}

! ===== ROUTING =====
{% if obj.config_context.default_gateway %}
route management 0.0.0.0 0.0.0.0 {{ obj.config_context.default_gateway }}
{% endif %}

! ===== SNMP CONFIGURATION =====
{% if obj.config_context.snmp %}
snmp-server host {{ obj.config_context.snmp.server }} {{ obj.config_context.snmp.interface | default('management') }} community {{ obj.config_context.snmp.community }}
snmp-server location {{ obj.location.name if obj.location else "Unknown" }}
snmp-server contact {{ obj.config_context.snmp.contact | default("admin@example.com") }}
snmp-server community {{ obj.config_context.snmp.community }} RO
{% endif %}

! ===== SYSLOG CONFIGURATION =====
{% if obj.config_context.syslog_servers %}
{% for syslog in obj.config_context.syslog_servers %}
logging host {{ obj.config_context.syslog_interface | default('management') }} {{ syslog }}
{% endfor %}
logging trap informational
logging enable
{% endif %}

! ===== AAA CONFIGURATION =====
{% if obj.config_context.aaa %}
aaa-server {{ obj.config_context.aaa.server_group }} protocol {{ obj.config_context.aaa.protocol | default('radius') }}
aaa-server {{ obj.config_context.aaa.server_group }} (management) host {{ obj.config_context.aaa.server }}
 key {{ obj.config_context.aaa.secret }}
aaa authentication ssh console {{ obj.config_context.aaa.server_group }} LOCAL
{% endif %}

! ===== SSH CONFIGURATION =====
crypto key generate rsa modulus 2048
ssh version 2
ssh timeout 30
{% if obj.config_context.ssh_allowed_networks %}
{% for network in obj.config_context.ssh_allowed_networks %}
ssh {{ network }} management
{% endfor %}
{% else %}
ssh 0.0.0.0 0.0.0.0 management
{% endif %}

! ===== BANNER =====
banner motd ***********************************************
banner motd * Unauthorized access is strictly prohibited *
banner motd * This system is managed by Nautobot        *
banner motd * Device: {{ obj.name }}
banner motd * Location: {{ obj.location.name if obj.location else "Unknown" }}
banner motd ***********************************************

! ===== END OF CONFIGURATION =====
